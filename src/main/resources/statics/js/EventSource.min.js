// License: http://rem.mit-license.org
!function(e){if(!("EventSource"in e)){var t=/^(\s|\u00A0)+|(\s|\u00A0)+$/g,r=function(e){var r=this,a=500,n=null,i="";if(!e||"string"!=typeof e)throw new SyntaxError("Not enough arguments");function l(e){r._pollTimer=setTimeout(function(){o.call(r)},e)}function o(){try{if(r.readyState==r.CLOSED)return;var e=new XMLHttpRequest;e.open("GET",r.URL,!0),e.setRequestHeader("Accept","text/event-stream"),e.setRequestHeader("Cache-Control","no-cache"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),null!=n&&e.setRequestHeader("Last-Event-ID",n),i="",e.timeout=5e4,e.onreadystatechange=function(){if(3==this.readyState||4==this.readyState&&200==this.status){r.readyState==r.CONNECTING&&(r.readyState=r.OPEN,r.dispatchEvent("open",{type:"open"}));var e="";try{e=this.responseText||""}catch(e){}var o=e.substr(i.length).split("\n"),h="message",d=[],u=0,c="";for(i=e;u<o.length;u++)if(0==(c=o[u].replace(t,"")).indexOf("event"))h=c.replace(/event:?\s*/,"");else if(0==c.indexOf("retry")){var p=parseInt(c.replace(/retry:?\s*/,""));isNaN(p)||(a=p)}else if(0==c.indexOf("data"))d.push(c.replace(/data:?\s*/,""));else if(0==c.indexOf("id:"))n=c.replace(/id:?\s*/,"");else if(0==c.indexOf("id"))n=null;else if(""==c&&d.length){var f=new s(d.join("\n"),r.url,n);r.dispatchEvent(h,f),d=[],h="message"}4==this.readyState&&l(a)}else r.readyState!==r.CLOSED&&(4==this.readyState?(r.readyState=r.CONNECTING,r.dispatchEvent("error",{type:"error"}),l(a)):0==this.readyState&&l(a))},e.send(),setTimeout(function(){e.abort()},e.timeout),r._xhr=e}catch(e){r.dispatchEvent("error",{type:"error",data:e.message})}}this.URL=e,this.readyState=this.CONNECTING,this._pollTimer=null,this._xhr=null,o()};r.prototype={close:function(){this.readyState=this.CLOSED,clearInterval(this._pollTimer),this._xhr.abort()},CONNECTING:0,OPEN:1,CLOSED:2,dispatchEvent:function(e,t){var r=this["_"+e+"Handlers"];if(r)for(var s=0;s<r.length;s++)r[s].call(this,t);this["on"+e]&&this["on"+e].call(this,t)},addEventListener:function(e,t){this["_"+e+"Handlers"]||(this["_"+e+"Handlers"]=[]),this["_"+e+"Handlers"].push(t)},removeEventListener:function(e,t){var r=this["_"+e+"Handlers"];if(r)for(var s=r.length-1;s>=0;--s)if(r[s]===t){r.splice(s,1);break}},onerror:null,onmessage:null,onopen:null,readyState:0,URL:""};var s=function(e,t,r){this.data=e,this.origin=t,this.lastEventId=r||""};s.prototype={data:null,type:"message",lastEventId:"",origin:""},"module"in e&&(module.exports=r),e.EventSource=r}}(this);
